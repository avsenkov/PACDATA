{
  "title": "Визиты",
  "type": "object",
  "required": ["code", "last_name"],
  "properties": {
    "code": { "type": "string", "title": "Код пациента" },
    "last_name": { "type": "string", "title": "Фамилия" },
    "first_name": { "type": "string", "title": "Имя" },
    "middle_name": { "type": "string", "title": "Отчество" },
    "primary_icd10_id": {
      "title": "Основное заболевание (МКБ)",
      "enum" : [1, 2],
      "enumNames": ["I10 — Гипертензия", "E11 — Сахарный диабет 2 типа"]
    },
    "secondary_icd10": { 
      "type": "array", 
      "title": "Сопутствующие заболевания",
      "items": {
        "type": "object",
        "required" : [],
        "properties" : {
          "icd10": {
            "title" : "Заболевание",
            "enum" : [1, 2],
            "enumNames" : ["I10 — Гипертензия", "E11 — Сахарный диабет 2 типа"]
          }
        }
      } 
    },
    "visits": {
      "type": "array",
      "title": "Визиты",
      "items": {
        "type": "object",
        "required": ["visit_date"],
        "properties": {
          "visit_date": { "type": "string", "format": "date", "title": "Дата визита" },
          "age_at_visit_years": { "type": "number", "title": "Возраст (лет)", "minimum": 0 },
          "weight_kg": { "type": "number", "title": "Вес (кг)", "minimum": 0 },
          "height_cm": { "type": "number", "title": "Рост (см)", "minimum": 0 },
          "BMI" : { "type": "number", "title": "ИМТ", "minimum": 0 }, 
          "additional_disease_text": { "type": "string", "title": "Доп. заболевание" },
          "next_visit_date": { "type": "string", "format": "date", "title": "Предполагаемая дата следующего визита" },
          "clinical_outcome_id": {
            "title": "Клинический исход",
            "enum": [1, 2, 3],
            "enumNames": ["Улучшение", "Без изменений", "Ухудшение"]
          },
          "drug_intakes": {
            "type": "array",
            "title": "Принимаемые препараты",
            "items": {
              "type": "object",
              "required": ["drug_id"],
              "properties": {
                "drug_id": {
                  "title": "Препарат",
                  "enum" : [1, 2],
                  "enumNames" : ["Препарат X", "Препарат Y"]
                },
                "dose": { "type": "string", "title": "Дозировка" },
                "unit_id": {
                  "title": "Дозировка в",
                  "enum": [1, 2],
                  "enumNames": ["мг", "мкг"]
                }, 
                "NumPeriod" : { "type": "string", "title": "Принимать раз" },
                "period" : {
                  "title": "в период",
                  "enum" : [1, 2],
                  "enumNames" : ["день", "2 дня"]
                },
                "Longitude" : { "type": "string", "title": "Продолжительность приема" },
                "Begining" : { "type": "string", "title": "Начало приема" }
              }
            }
          },
          "hospital_tests": {
            "type": "array",
            "title": "Лабораторные исследования",
            "items": {
              "type": "object",
              "required": ["name", "value_text"],
              "properties": {
                "name": { "type": "string", "title": "Название (c ед.)", "examples": ["ALT (U/L)"] },
                "value_text": { "type": "string", "title": "Значение" }
              }
            }
          },
          "instrumental_tests": {
            "type": "array",
            "title": "Инструментальные исследования",
            "items": {
              "type": "object",
              "required": ["name", "value_text"],
              "properties": {
                "name": { "type": "string", "title": "Название", "examples": ["УЗИ","МРТ","Трузи"] },
                "comment": { "type": "string", "title": "Описание" },
                "resolution": {"type": "string", "title": "Заключение" }
              }
            }
          },
          "lab_genetics": {
            "type": "array",
            "title": "Генетика",
            "items": {
              "type": "object",
              "required": ["analyte_name", "value_text"],
              "properties": {
                "analyte_name": { "type": "string", "title": "Маркер/ген/вариант" },
                "value_text": { "type": "string", "title": "Значение" },
                "interpretation" : {"type": "string", "title": "Интерпретация"}
              }
            }
          },
          "lab_concentrations": {
            "type": "array",
            "title": "Концентрация ЛП",
            "items": {
              "type": "object",
              "required": ["drug_id", "value_num"],
              "properties": {
                "drug_id": {
                  "title": "Препарат",
                  "enum" : [1, 2],
                  "enumNames" : ["Препарат X", "Препарат Y"]
                },
                "value_num": { "type": "number", "title": "Значение" },
                "unit_id": {
                  "title": "Ед. изм.",
                  "enum": [2, 3],
                  "enumNames": ["мг/л", "нг/мл"]
                }
              }
            }
          },
          "lab_phenotyping": {
            "type": "array",
            "title": "Фенотипирование",
            "items": {
              "type": "object",
              "required": ["drug_id"],
              "properties": {
                "drug_id": {
                  "title": "Препарат",
                  "enum" : [1, 2],
                  "enumNames" : ["Препарат X", "Препарат Y"]
                },
                "metabolites": {
                  "type": "array",
                  "title": "Метаболиты",
                  "items": {
                    "type": "object",
                    "required": ["metabolite_name", "value_num"],
                    "properties": {
                      "metabolite_name": { "type": "string", "title": "Назвние" },
                      "value_num": { "type": "number", "title": "Значение" },
                      "unit_id": {
                        "title": "Ед. изм.",
                        "enum": [2, 3],
                        "enumNames": ["мг/л", "нг/мл"]
                      }
                    }
                  }
                }
              }
            }
          },
          "lab_microrna": {
            "type": "array",
            "title": "микроРНК",
            "items": {
              "type": "object",
              "required": ["analyte_name", "value_num"],
              "properties": {
                "analyte_name": { "type": "string", "title": "Название" },
                "value_num": { "type": "number", "title": "Значение" },
                "unit_id": {
                  "title": "Ед. изм.",
                  "enum": [4],
                  "enumNames" : ["ед."]
                }
              }
            }
          }
        }
      }
    }
  }
}
